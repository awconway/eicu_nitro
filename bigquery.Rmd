---
output::html_document
---

```{r setup, include = FALSE}
library(targets)
```

## Load data from bigquery

```{targets eicuConn}
  tar_target(eicu_conn, make_connection(
    project = "physionet-data",
    dataset = "eicu_crd",
    billing = "sapient-pen-274417"
  ))
```

```{targets patient}
  tar_target(
    patient,
    query_cols(
      connection = eicu_conn,
      table = "patient",
      columns = "patientunitstayid,
       age,
       apacheadmissiondx,
       ethnicity,
       gender,
       admissionheight,
       admissionweight,
       unitAdmitSource,
       uniquepid,
       hospitalid"
    )
  )
```

```{targets nitro}
  tar_target(
    nitro,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Nitroglycerin (mcg/min)'"
    )
  )
```

```{targets dobumatine}

  tar_target(
    dobutamine,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Dobutamine (mcg/kg/min)'"
    )
  )
```

zero results returned for phenylephrine

```{targets phenylephrine}
  tar_target(
    phenylephrine,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Phenylephrine (mcg/hr)'"
    )
  )
```

only 2 patients who were on furosemide during a nitro titration

```{targets furosemide}
  tar_target(
    furosemide,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Furosemide (mg/hr)'"
    )
  )
```

Propofol ml/hr or mcg/kg/min doesn't occur frequently

```{targets propofol}
  tar_target(
    propofol,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Propofol (mcg/kg/min)'"
    )
  )
```

only 6 patients who were on norepinephrine during a nitro titration

```{targets norepinephrine}
 tar_target(
    norepinephrine,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Norepinephrine (mcg/min)'"
    )
  )
```

 Fentanyl ml/hr doesn't occur frequently in patients who received nitro

```{targets fentanyl}
  tar_target(
    fentanyl,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Fentanyl (mcg/hr)'"
    )
  )
```

```{targets midaz}
  tar_target(
    midaz,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Midazolam (mg/hr)'"
    )
  )
```

```{targets dex}
  tar_target(
    dex,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Dexmedetomidine (mcg/kg/hr)'"
    )
  )
```

```{targets nicardipine}
 tar_target(
    nicardipine,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Nicardipine (mg/hr)'"
    )
  )
```

```{targets amiodarone}
  tar_target(
    amiodarone,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Amiodarone (mg/min)'"
    )
  )
```

```{targets fluids}
  tar_target(
    fluids,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'NSS (ml/hr)' OR
      drugname = 'IVF (ml/hr)' OR
      drugname = 'NS (ml/hr)' OR
      drugname = '0.9 Sodium Chloride (ml/hr)' OR
      drugname = 'Normal saline (ml/hr)' OR
      drugname = 'normal saline (ml/hr)' OR
      drugname = 'NACL (ml/hr)'"
    )
  )
```

```{targets milrinone}
  tar_target(
    milrinone,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Milrinone (mcg/kg/min)'"
    )
  )
```

```{targets epinephrine}
 tar_target(
    epinephrine,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Epinephrine (mcg/min)'"
    )
  )
```

```{targets vasopressin}
 tar_target(
    vasopressin,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Vasopressin (units/min)'"
    )
  )
```

```{targets diltiazem}

  tar_target(
    diltiazem,
    query_rows(
      connection = eicu_conn,
      table = "infusiondrug",
      columns = "patientunitstayid,
       infusionoffset,
       drugname,
       drugrate",
      rows = "drugname = 'Diltiazem (mg/hr)'"
    )
  )
```

```{targets sbpNurseCharting}
  tar_target(
    sbp_nurse_charting, query_rows(eicu_conn,
      table = "nursecharting",
      columns = "patientunitstayid,
               nursingchartoffset,
               nursingchartcelltypevalname,
               nursingchartvalue",
      rows = "nursingchartcelltypevalname = 'Non-Invasive BP Systolic'
          OR nursingchartcelltypevalname = 'Invasive BP Systolic'"
    )
  )
```

```{targets pain}
  tar_target(
    pain, query_rows(eicu_conn,
      table = "nursecharting",
      columns = "patientunitstayid,
               nursingchartoffset,
               nursingchartcelltypevalname,
               nursingchartvalue",
      rows = "nursingchartcelltypevalname = 'Pain Score'"
    )
  )
```

```{targets vitalAperiodic}
  tar_target(
    vital_aperiodic,
    query_cols(
      connection = eicu_conn,
      table = "vitalaperiodic",
      columns = "patientunitstayid,
            observationoffset,
            noninvasivesystolic"
    )
  )
```

```{targets vitalPeriodic}
  tar_target(
    vital_periodic,
    query_cols(
      connection = eicu_conn,
      table = "vitalperiodic",
      columns = "patientunitstayid,
            observationoffset,
            systemicsystolic"
    )
  )
```

```{targets apacheapsvar}
  tar_target(
    apacheapsvar,
    query_cols(
      connection = eicu_conn,
      table = "apacheapsvar",
      columns = "*"
    )
  )
```

```{targets apachepatientresult}
  tar_target(
    apachepatientresult,
    query_cols(
      connection = eicu_conn,
      table = "apachepatientresult",
      columns = "patientunitstayid,
       apachescore,
       apacheversion"
    )
  )
```

```{targets apachepredvar}
  tar_target(
    apachepredvar,
    query_cols(
      connection = eicu_conn,
      table = "apachepredvar",
      columns = "*"
    )
  )
```

```{targets creat}
  tar_target(
    creat,
    query_rows(
      connection = eicu_conn,
      table = "lab",
      columns = "patientunitstayid,
      labname,
      labresultoffset,
      labresult",
      rows = "labname = 'creatinine'"
    )
  )
```